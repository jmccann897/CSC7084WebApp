<!-- Dashboard that loads up all records within the database -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard template</title>
    <link rel="stylesheet" href="mystyles.css" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
  </head>
  <body>
    <div class=".container"><%- include('header'); %></div>

    <div class=".container"><%- include('nav'); %></div>

    <!-- Historical data table -->
    <div class=".container border border-danger">
      <div class="bd-example">
        <table class="table table-hover" id="history">
          <thead>
            <tr>
              <th scope="col">Datetime</th>
              <th scope="col">Snap ID</th>
              <th scope="col">Happiness</th>
              <th scope="col">Sadness</th>
              <th scope="col">Disgust</th>
              <th scope="col">Contempt</th>
              <th scope="col">Anger</th>
              <th scope="col">Fear</th>
              <th scope="col">Surprise</th>
            </tr>
          </thead>
          <tbody>

            <% const dateformat = {weekday:'long', year:'numeric', month:'long', day:'numeric'}; %>
            <% let id_count = 0; %>
            <% let id_max = history.reduce((acc, value) => { %>
                <% return (acc = acc > value.snapshot_id ? acc: value.snapshot_id); %>
            <% }, 0); %>
            
            
            <% let happy_score =0; %>
            <% let sad_score =0; %>
            <% let disgust_score =0; %>
            <% let contempt_score =0; %>
            <% let anger_score =0; %>
            <% let fear_score =0; %>
            <% let surprise_score =0; %>

            <!--Loop through history per id_count from 0 to id_max-->
            <% for (let i =1; i <= id_max; i++){ %>
                <% console.log(i); %>
                <% const data_array = history.filter((row) => row.snapshot_id === i); %>

                <!--If no data points +1 to id_count-->
                <% if(data_array.length <1) {continue} %>
                <!--If data, then set date & scores and output-->
                <!-- Looping through history filtered to snapID-->
                <% data_array.forEach((row) =>{ %>
                              
                    <% let emotion_name =""; %>
                    <% if(row.emotion_id === 3){ %>
                      <% emotion_name = "happinness"; %>
                      <% happy_score = row.score; %>
                    <% } %>
    
                    <% if(row.emotion_id === 2){ %>
                      <% emotion_name = "sadness"; %>
                      <% sad_score = row.score; %>
                    <% } %>
    
                    <% if(row.emotion_id === 3){ %>
                      <% emotion_name = "disgust"; %>
                      <% disgust_score = row.score; %>
                    <% } %>
    
                    <% if(row.emotion_id === 4){ %>
                      <% emotion_name = "contempt"; %>
                      <% contempt_score = row.score; %>
                    <% } %>
    
                    <% if(row.emotion_id === 5){ %>
                      <% emotion_name = "anger"; %>
                      <% anger_score = row.score; %>
                    <% } %>
    
                    <% if(row.emotion_id === 6){ %>
                      <% emotion_name = "fear"; %>
                      <% fear_score = row.score; %>
                    <% } %>
    
                    <% if(row.emotion_id === 7){ %>
                      <% emotion_name = "surprise"; %>
                      <% surprise_score = row.score; %>
                    <% } %>
                <% }); %>

                <!--Outputting-->
                <tr>

                  <% var rawdate = new Date(history[0].datetime); %>
                  <% var formatteddate = new Intl.DateTimeFormat('en-GB',dateformat).format(rawdate); %>
                      <td><%= formatteddate %></td>
                      <td><%= i %></td>
                      <td><%= happy_score %></td>
                      <td><%= sad_score %></td>
                      <td><%= disgust_score %></td>
                      <td><%= contempt_score %></td>
                      <td><%= anger_score %></td>
                      <td><%= fear_score %></td>
                      <td><%= surprise_score %></td>
                </tr>

            <% } %>
                  
          </tbody>
        </table>
      </div>
    </div>
  </body>
</html>
